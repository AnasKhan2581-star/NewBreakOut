<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
>üöÄ Pro Crypto Breakout Trade-Setup Scanner</title>
<style>
  /* ----------  DARK NEON UI THEME  ---------- */
  :root{
    --bg:#0c0c0c;--panel:#161616;--accent:#00ffae;--warn:#ffce00;
    --pass:#16c784;--fail:#ff4957;--text:#e6e6e6;--border:#333;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
  body{background:var(--bg);color:var(--text);padding:12px}
  h1,h3{text-align:center}
  h1{color:var(--accent);font-size:5.2vw;margin-bottom:15px}
  select,input,button{
    background:var(--panel);color:var(--text);border:1px solid var(--border);
    padding:10px 12px;border-radius:8px;font-size:1.1em;width:220px
  }
  button{transition:background .2s}
  button:hover{background:#222;cursor:pointer}
  .container{max-width:1100px;margin:auto}
  .controls,.stats,.analysis-section{margin:18px 0;text-align:center}
  .trade-box{
    background:var(--panel);border-radius:10px;padding:16px;margin:26px auto;
    max-width:720px;box-shadow:0 0 14px #0007
  }
  .trade-box h2{color:var(--accent);margin-bottom:8px;font-size:1.35em}
  .trade-box table{width:100%;border-collapse:collapse;margin-top:10px;font-size:.92em}
  .trade-box th,.trade-box td{padding:7px 10px;border-bottom:1px solid var(--border);text-align:left}
  .trade-box th{color:var(--warn)}
  .pass{color:var(--pass);font-weight:700}
  .fail{color:var(--fail);font-weight:700}
  .log-box{
    background:#111;border:1px solid #0a0;border-radius:8px;color:#0f0;
    font-family:monospace;padding:10px;max-height:190px;overflow-y:auto
  }
</style>
</head>
<body>
<div class="container">
  <h1>üöÄ Pro Crypto Breakout Trade-Setup Scanner</h1>

  <!-- ======== CONTROLS ======== -->
  <div class="controls">
    <label for="timeframe">Select Timeframe:</label><br/>
    <select id="timeframe">
      <option value="1m">1 m</option><option value="3m">3 m</option>
      <option value="5m">5 m</option><option value="15m" selected>15 m</option>
      <option value="30m">30 m</option><option value="1h">1 h</option>
      <option value="4h">4 h</option><option value="1d">1 d</option>
    </select><br/>

    <label for="accountSize">Account Size ($):</label><br/>
    <input id="accountSize" type="number" min="100" step="100" value="1000"/><br/>

    <label for="riskPerTrade">Risk per Trade (%):</label><br/>
    <input id="riskPerTrade" type="number" min="0.1" max="5" step="0.1" value="1"/><br/>

    <label for="minRR">Min R:R Ratio:</label><br/>
    <input id="minRR" type="number" min="1" max="10" step="0.1" value="2"/><br/>

    <label for="minTargetPercent">Min Target Upside %:</label><br/>
    <input id="minTargetPercent" type="number" min="1" max="30" step="0.1" value="5"/><br/>

    <label for="volumeMultiplier">Volume Multiplier √ó:</label><br/>
    <input id="volumeMultiplier" type="number" min="1" max="10" step="0.1" value="1.8"/><br/>

    <button id="scanButton">üîç Start Scan</button>
  </div>

  <!-- ======== GLOBAL STATS ======== -->
  <div class="stats">
    <span>Coins Scanned: <b id="coinsScanned">0</b></span> |
    <span>Qualified: <b id="qualifiedSetups">0</b></span> |
    <span>Avg R:R: <b id="avgRR">0.0</b></span> |
    <span>Avg Target: <b id="avgTarget">0.0 %</b></span>
  </div>

  <!-- ======== INDIVIDUAL ANALYSIS ======== -->
  <div class="analysis-section">
    <h3>üî¨ Analyse Single Coin</h3>
    <input type="text" id="individualCoinInput" placeholder="BTCUSDT" style="width:250px;margin-bottom:8px"/>
    <br/><button id="analyzeCoinButton">Analyse</button>
    <div id="individualAnalysisResult" style="margin-top:22px"></div>
  </div>

  <!-- ======== LIST SCAN RESULTS ======== -->
  <div id="scanResults" style="margin-top:34px"></div>

  <!-- ======== LOG BOX ======== -->
  <div class="log-box" id="logBox">Ready‚Ä¶</div>
</div>

<script>
/*--------------------------------------------------------------------
  ‚ñì‚ñì  CORE CONFIG & UTILITIES
--------------------------------------------------------------------*/
const API = "https://api.binance.com";
const sleep = ms => new Promise(r => setTimeout(r, ms));
const avg   = arr => arr.reduce((a,b)=>a+b,0)/arr.length||0;
const log   = msg=>{
  const lb=document.getElementById("logBox");
  lb.textContent+=`\n${new Date().toLocaleTimeString()}  ${msg}`;
  lb.scrollTop=lb.scrollHeight;
};

/*--------------------------------------------------------------------
  ‚ñì‚ñì  INDICATORS
--------------------------------------------------------------------*/
function calcRSI(closes,p=14){
  if(closes.length<p+1)return [];
  const gains=[],losses=[];
  for(let i=1;i<closes.length;i++){
    const ch=closes[i]-closes[i-1];
    gains.push(ch>0?ch:0);losses.push(ch<0?-ch:0);
  }
  const rsi=[];
  for(let i=p-1;i<gains.length;i++){
    const ag=avg(gains.slice(i-p+1,i+1));
    const al=avg(losses.slice(i-p+1,i+1));
    const rs=al===0?100:100-100/(1+ag/al);
    rsi.push(rs);
  }
  return rsi;
}

/*  3-phase smoothed StochRSI    */
function calcStochRSI(rsi,p=14){
  if(rsi.length<p)return{K:[],D:[]};
  const raw=[];
  for(let i=p-1;i<rsi.length;i++){
    const slice=rsi.slice(i-p+1,i+1);
    const min=Math.min(...slice),max=Math.max(...slice);
    raw.push(max===min?0:((rsi[i]-min)/(max-min))*100);
  }
  /* 3-period SMA for %K and %D */
  const K=[],D=[];
  for(let i=2;i<raw.length;i++){
    K.push(avg(raw.slice(i-2,i+1)));
    if(i>=4) D.push(avg(K.slice(K.length-3)));
  }
  return{K,D};
}

/* Is recent bullish StochRSI cross (<85)? */
function bullishStochCross(K,D,maxLookback=3,cap=85){
  const len=Math.min(K.length,D.length);
  for(let i=1;i<=maxLookback;i++){
    const k1=K[len-i-1],k2=K[len-i];
    const d1=D[len-i-1],d2=D[len-i];
    if(k1<=d1 && k2>d2 && k2<cap) return true;
  }
  return false;
}

/* ATR ‚Äì Wilder‚Äôs smoothing (simple for speed) */
function calcATR(c,p=14){
  const trs=[];
  for(let i=1;i<c.length;i++){
    const hl=c[i].high-c[i].low,
          hc=Math.abs(c[i].high-c[i-1].close),
          lc=Math.abs(c[i].low-c[i-1].close);
    trs.push(Math.max(hl,hc,lc));
  }
  return trs.length>=p?avg(trs.slice(-p)):null;
}

/* Recent pivot-highs above price used as next-resistance targets */
function pivotHighTargets(c,entry,minPct,count=5,look=5){
  const pivots=[];
  for(let i=look;i<c.length-look;i++){
    const seg=c.slice(i-look,i+look+1);
    const hi=Math.max(...seg.map(x=>x.high));
    if(hi===c[i].high && hi>entry && (hi-entry)/entry>=minPct/100) pivots.push(hi);
  }
  return [...new Set(pivots)].sort((a,b)=>a-b).slice(0,count);
}

/* Fair-Value-Gap finder: bullish gaps not yet filled after breakout */
function fairValueGaps(c,entry,minGapPct=0.5,count=5){
  const gaps=[];
  for(let i=2;i<c.length-2;i++){
    const prevHigh=c[i-1].high,nextLow=c[i+1].low;
    const gap=(nextLow-prevHigh)/entry*100;
    if(nextLow>prevHigh && nextLow>entry && gap>=minGapPct)
      gaps.push(nextLow);
  }
  return [...new Set(gaps)].sort((a,b)=>a-b).slice(0,count);
}

/*--------------------------------------------------------------------
  ‚ñì‚ñì  DATA FETCHERS
--------------------------------------------------------------------*/
async function topCoins(limit=150){
  const d=await fetch(`${API}/api/v3/ticker/24hr`).then(r=>r.json());
  return d.filter(x=>x.symbol.endsWith("USDT")&&!/UP|DOWN/.test(x.symbol))
          .sort((a,b)=>b.quoteVolume-a.quoteVolume).slice(0,limit);
}
async function candles(sym,intvl,limit=300){
  const json=await fetch(`${API}/api/v3/klines?symbol=${sym}&interval=${intvl}&limit=${limit}`).then(r=>r.json());
  return json.map(d=>({open:+d[1],high:+d[2],low:+d[3],close:+d[4],volume:+d[5],time:d[0]}));
}

/*--------------------------------------------------------------------
  ‚ñì‚ñì  CORE EVALUATOR
--------------------------------------------------------------------*/
async function analyse(sym,intvl,settings){
  const {
    accountSize=1000,riskPct=1,minRR=2,minTargetPct=5,volMult=1.8
  }=settings;
  try{
    const c=await candles(sym,intvl,300);
    if(c.length<60) return{error:"Not enough candles"};

    const closes=c.map(x=>x.close);
    const rsi=calcRSI(closes);
    const {K,D}=calcStochRSI(rsi);
    const last=c.at(-1);

    /* Resistance = highest high in lookback; touches within 1¬Ω %   */
    const lookback=50;
    const resist=Math.max(...c.slice(-lookback).map(x=>x.high));
    const touches=c.slice(-lookback).filter(x=>Math.abs(x.high-resist)/resist<=0.015).length;

    /* Volume surge check                                           */
    const avgVol=avg(c.slice(-30,-1).map(x=>x.volume));
    const volSurge=last.volume>=avgVol*volMult;

    /* StochRSI bullish cross (<85)                                 */
    const stochBull=bullishStochCross(K,D);

    /* Proximity to resistance within 1.5 %                         */
    const proxPct=Math.abs(last.close-resist)/resist*100;
    const proxPass=proxPct<=1.5;

    /* Targets                                                      */
    const fvg=fairValueGaps(c,last.close,settings.minTargetPct);
    const pivots=pivotHighTargets(c,last.close,settings.minTargetPct);
    const targets=[...fvg,...pivots].slice(0,5);

    /* ATR-based stop (2√óATR below entry)                           */
    const atr=calcATR(c)??resist*0.01;
    const stop=last.close-2*atr;
    const bestRR=targets.length?Math.max(...targets.map(t=>(t-last.close)/(last.close-stop))):0;
    const rrPass=bestRR>=minRR;

    /* Criteria tally                                               */
    const criteria=[
      {name:"Volume Surge",         pass:volSurge,  val:`${last.volume.toFixed(0)} / ${avgVol.toFixed(0)}`},
      {name:"Near Resistance",      pass:proxPass,  val:`${proxPct.toFixed(2)} %`},
      {name:"Bullish StochRSI <85", pass:stochBull, val:`K:${K.at(-1)?.toFixed(1)||"--"} D:${D.at(-1)?.toFixed(1)||"--"}`},
      {name:`‚â•${minTargetPct}% Targets`,pass:targets.length>0,val:targets.length},
      {name:`R:R ‚â• ${minRR}`,       pass:rrPass,    val:bestRR.toFixed(2)}
    ];
    const passed=criteria.filter(x=>x.pass).length;
    const qualified=passed>=4;

    return{
      symbol:sym,qualified,criteria,passed,
      price:last.close,resistance:resist,touches,
      stop:stop.toFixed(6),
      riskReward:bestRR.toFixed(2),
      volume:last.volume,avgVolume:avgVol,
      stoch: {K:K.at(-1)||0,D:D.at(-1)||0},
      rsi:rsi.at(-1)||0,targets:targets.map(x=>x.toFixed(6))
    };
  }catch(e){return{error:e.message}}
}

/*--------------------------------------------------------------------
  ‚ñì‚ñì  RENDER HELPERS
--------------------------------------------------------------------*/
function render(setup,wrap){
  const crit=setup.criteria.map(c=>
    `<tr><td>${c.name}</td><td class="${c.pass?"pass":"fail"}">${c.pass?"‚úÖ":"‚ùå"} ${c.val}</td></tr>`
  ).join("");
  wrap.innerHTML+=`
    <div class="trade-box">
      <h2>${setup.qualified?"‚úÖ":"‚ùå"} <b>${setup.symbol}</b> ${setup.qualified?"Setup":"‚Äì Not Qualified"}</h2>
      <table>
        <tbody>
          <tr><th>Key</th><th>Value</th></tr>
          <tr><td>Entry</td><td>${setup.price.toFixed(6)}</td></tr>
          <tr><td>Resistance</td><td>${setup.resistance.toFixed(6)} (${setup.touches} touches)</td></tr>
          <tr><td>Stop-Loss</td><td>${setup.stop}</td></tr>
          <tr><td>Targets</td><td>${setup.targets.join(" ‚Üí ")||"‚Äì"}</td></tr>
          <tr><td>R:R</td><td>${setup.riskReward}</td></tr>
          <tr><td>Volume</td><td>${setup.volume.toFixed(0)} / ${setup.avgVolume.toFixed(0)}</td></tr>
          <tr><td>StochRSI K/D</td><td>${setup.stoch.K.toFixed(1)} / ${setup.stoch.D.toFixed(1)}</td></tr>
          <tr><td>RSI</td><td>${setup.rsi.toFixed(1)}</td></tr>
        </tbody>
      </table>
      <table><thead><tr><th>Criteria</th><th>Status</th></tr></thead><tbody>${crit}</tbody></table>
      <p style="text-align:center;font-weight:bold;color:${setup.qualified?"var(--pass)":"var(--fail)"}">
        ${setup.qualified?`QUALIFIED (${setup.passed}/5)`: `NOT QUALIFIED (${setup.passed}/5)`}
      </p>
    </div>`;
}

/*--------------------------------------------------------------------
  ‚ñì‚ñì  SCAN LOOP
--------------------------------------------------------------------*/
async function scan(){
  const tf=document.getElementById("timeframe").value;
  const settings={
    accountSize:+document.getElementById("accountSize").value||1000,
    riskPct:+document.getElementById("riskPerTrade").value||1,
    minRR:+document.getElementById("minRR").value||2,
    minTargetPct:+document.getElementById("minTargetPercent").value||5,
    volMult:+document.getElementById("volumeMultiplier").value||1.8
  };
  const btn=document.getElementById("scanButton");
  const wrap=document.getElementById("scanResults");
  btn.disabled=true;wrap.innerHTML="";log("Starting scan ‚Ä¶");
  const coins=await topCoins();
  let setups=[],i=0;
  for(const coin of coins){
    document.getElementById("coinsScanned").textContent=++i;
    log(`Analysing ${coin.symbol} (${i}/${coins.length})`);
    const s=await analyse(coin.symbol,tf,settings);
    if(!s.error && s.qualified){setups.push(s);document.getElementById("qualifiedSetups").textContent=setups.length;}
    if(i%12===0) await sleep(1000);   // gentle rate-limit
  }
  if(!setups.length){wrap.innerHTML="<p style='color:var(--fail);text-align:center;font-weight:bold'>No qualified breakouts.</p>";}
  else{
    const avgRR=avg(setups.map(x=>+x.riskReward));document.getElementById("avgRR").textContent=avgRR.toFixed(2);
    const avgTgt=avg(setups.map(x=>(x.targets.length?+x.targets[0]:0)/x.price))*100;
    document.getElementById("avgTarget").textContent=avgTgt.toFixed(2)+" %";
    setups.forEach(s=>render(s,wrap));
  }
  btn.disabled=false;
}

/*--------------------------------------------------------------------
  ‚ñì‚ñì  EVENT BINDINGS
--------------------------------------------------------------------*/
document.getElementById("scanButton").addEventListener("click",scan);

document.getElementById("analyzeCoinButton").addEventListener("click",async()=>{
  const symInp=document.getElementById("individualCoinInput");
  const out=document.getElementById("individualAnalysisResult");
  const tf=document.getElementById("timeframe").value;
  let sym=symInp.value.trim().toUpperCase(); if(!sym) return out.innerHTML="<p style='color:var(--fail)'>Enter symbol</p>";
  if(!sym.endsWith("USDT")) sym+="USDT";
  out.innerHTML="<p>Analysing ‚Ä¶</p>";
  const res=await analyse(sym,tf,{minRR:+document.getElementById("minRR").value,minTargetPct:+document.getElementById("minTargetPercent").value,volMult:+document.getElementById("volumeMultiplier").value});
  if(res.error) out.innerHTML=`<p style='color:var(--fail)'>${res.error}</p>`;
  else {out.innerHTML="";render(res,out);}
});
</script>
</body>
</html>
